<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>ゲーム本編</title>
    <style>
      #game-window{
        position: absolute;
        border: 1px solid red;
        width: 400px;
        height: 300px;

        background-image: url(image/back/title.jpg);
        background-size: cover;
      }
      #message{
        position: absolute;
        top: 170px;
        left: 50px;
        border: 1px solid green;
        width: 300px;
        height: 100px;

        background-color: rgba(255,255,255,0.8);
        border-radius: 5px;
      }
      #chara1{
        position: absolute;
        top: 15px;
        left: 10px;
        width: 150px;
      }
    </style>
  </head>
  <body>

    <div id="game-window">
      <img src="image/chara/6.png" id="chara1">
      <div id="message">
        こんにちは！
      </div>
    </div>

    <script src="scenario.js"></script>
    <script>
      let i = 0;
  
      const username   = localStorage.getItem("username");
      const gameWindow = document.querySelector("#game-window");
      const chara1     = document.querySelector("#chara1");

      const body = document.querySelector("body");
      body.style.backgroundImage = "url(image/back/fantasy_001.jpg)";


      const message = document.querySelector("#message");
      message.addEventListener("click", ()=>{
        const command = scenario[i][0];
        const value   = scenario[i][1];
        
        switch(command){
          case "SERIF":
            changeMessage(value);
            break;

          case "BGIMAGE":
            changeBackground(value);
            break;
          
          case "SE":
            playSE(value);
            break;
          
          case "SE-RAND":
            playSeRand(value);
            break;
          
          case "BGIMAGE-RAND":
            // 【課題】ランダムに背景を変更
            break;
          
          case "CHARA":
            changeChara(value);
            break;
        }
        i++;
      });
    
      function changeMessage(text){
        message.innerHTML = text
                              // 【課題】ユーザー名をシナリオに入れる
                              .replace("%FOOD%", "バナナ")
                              .replace("%WEATHER%", "雨");
      }
    
      function changeBackground(url){
        gameWindow.style.backgroundImage = url;
      }

      function playSE(url){
        const se = new Audio(url);
        se.play();
      }

      function playSeRand(urls){
        const n = Math.floor( Math.random() * 100 ) % urls.length;
        playSE(urls[n]);
      }

      function changeChara(url){
        chara1.setAttribute("src", url);
      }
    </script>
  </body>
</html>